version: '3.3'

services:
  staging.jtiong.dev:
    image: php:7.4
    build:
      context: .
      dockerfile: Dockerfile
    external_links:
      - core_db
    container_name: staging.jtiong.dev
    volumes:
      - ../code:/var/www/html
      - ./php.ini:/usr/local/etc/php/conf.d/php.ini
      - ./vhost.conf:/etc/apache2/sites-available/000-default.conf
      - ../data/logs/error.log:/var/www/error.log
      - ../data/logs/access.log:/var/www/access.log
    environment:
      VIRTUAL_HOST: staging.jtiong.dev
      LETSENCRYPT_HOST: staging.jtiong.dev
      LETSENCRYPT_EMAIL: j.tiong.notifier@gmail.com
    restart: always

networks:
    default:
      name: proxy
